<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>realfimodel — 50-Unit REI Model</title>
<meta name="description" content="Free real estate multifamily finance model — value an apartment before you buy, finance, or make an offer." />
<meta name="keywords" content="free real estate multifamily finance model, apartment valuation, pro forma, IRR, cash-on-cash" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root{--bg:#ffffff;--accent:#0ea5a4;--muted:#475569;--yellow:#fff8dc;--formula:#f3f6fb;--drop:#fde68a}
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,Arial,sans-serif;color:#0f172a}
  .wrap{max-width:1024px;margin:10px auto;padding:10px}
  header{display:flex;align-items:center;gap:12px}
  #logo{height:48px;width:48px;object-fit:contain}
  h1{font-size:18px;margin:0}
  .meta{font-size:12px;color:var(--muted)}
  .controls{margin-left:auto;display:flex;gap:8px}
  .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .btn.primary{background:linear-gradient(90deg,#06b6d4,#3b82f6);color:white}

  .layout{display:grid;grid-template-columns:420px 1fr;gap:12px;margin-top:12px}
  .panel{border-radius:8px;padding:10px;border:1px solid #e6eef8;background:#fff}
  .compact-row{display:flex;justify-content:space-between;align-items:center;margin:6px 0;font-size:13px}
  label{font-size:12px;color:var(--muted);margin-right:8px}
  input[type=number], input[type=text], select{padding:6px;border-radius:6px;border:1px solid #e6eef8;width:120px}
  input.input-yellow{background:var(--yellow)}
  .formula{background:var(--formula)}
  .units-table{width:100%;border-collapse:collapse;margin-top:6px}
  .units-table th,.units-table td{padding:6px;border-bottom:1px solid #f3f6fb;font-size:12px}
  .units-table td input{width:80px}
  .units-table td.input{background:var(--yellow)}

  table.pro{border-collapse:collapse;width:100%;min-width:700px;margin-top:8px}
  table.pro th, table.pro td{padding:6px;border:1px solid #eef4fb;font-size:12px;text-align:right}
  table.pro th{background:#fbfdff;color:var(--muted);text-align:left}

  .kpis{display:flex;gap:8px;margin-top:10px}
  .kpi{flex:1;padding:10px;border-radius:8px;background:linear-gradient(180deg,#fff,#fbfdff);text-align:center}

  /* center area for youtube video drop zone */
  .media-grid{display:grid;grid-template-columns:1fr 480px 1fr;gap:12px;margin-top:12px}
  .video-drop{border:3px dashed var(--drop);border-radius:8px;min-height:200px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(253,230,138,0.15),rgba(255,255,255,0.02));color:#92400e}
  .video-drop .hint{font-weight:700}

  footer{margin-top:14px;padding-top:8px;border-top:1px solid #eef4fb;text-align:center;font-size:12px;color:var(--muted)}
  footer a{color:var(--accent);margin:0 6px}

  @media print{
    .controls,.btn{display:none}
    .layout{grid-template-columns:1fr 1fr}
    .media-grid{grid-template-columns:1fr}
    .video-drop{border-style:solid}
    table.pro{font-size:10px}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <img id="logo" src="logo.png" alt="logo">
    <div>
      <h1>realfimodel</h1>
      <div class="meta">Free real estate multifamily finance model — value an apartment before you buy, finance, or make an offer.</div>
    </div>
    <div class="controls">
      <button class="btn" id="resetBtn">Reset</button>
      <button class="btn primary" id="calcInBtn">Calculate In → Populate Pro Forma</button>
      <button class="btn primary" id="recalcBtn">Recalculate</button>
      <button class="btn" id="exportBtn">Export CSV</button>
    </div>
  </header>

  <div class="layout">
    <!-- Left: Inputs + Operating Expenses (moved here, marked yellow) -->
    <div class="panel">
      <h3 style="margin:0 0 6px">TAB 1 — INPUTS (Edit yellow fields)</h3>
      <div class="meta">Operating expenses moved here — these are inputs. Use "Calculate In" to push rents into the Pro Forma.</div>

      <div style="margin-top:8px">
        <div class="compact-row"><label>Project Name</label><input id="projectName" type="text" class="input-yellow" value="xyz"></div>
        <div class="compact-row"><label>Total Units</label><input id="totalUnits" type="number" class="input-yellow" value="50"></div>
        <div class="compact-row"><label>Rentable Sq Ft</label><input id="rentableSqft" type="number" class="input-yellow" value="51745"></div>
        <div class="compact-row"><label>Purchase Price</label><input id="purchasePrice" type="number" class="input-yellow" value="20000000"></div>
        <div class="compact-row"><label>Closing Costs %</label><input id="closingPct" type="number" class="input-yellow" value="1"></div>
        <div class="compact-row"><label>Renovation Budget</label><input id="renovation" type="number" class="input-yellow" value="500000"></div>
        <div class="compact-row"><label>Total Initial Basis</label><input id="totalBasis" class="formula" readonly value="20,700,000"></div>
        <hr>
        <h4 style="margin:8px 0 6px">OPERATING EXPENSES (YR1) — Inputs</h4>
        <div class="compact-row"><label>Prop Taxes %</label><input id="propTaxPct" type="number" class="input-yellow" value="1.25"></div>
        <div class="compact-row"><label>Insurance $/unit/yr</label><input id="insPerUnit" type="number" class="input-yellow" value="500"></div>
        <div class="compact-row"><label>Mgmt Fee % of EGI</label><input id="mgmtPct" type="number" class="input-yellow" value="4"></div>
        <div class="compact-row"><label>Repairs $/unit/yr</label><input id="repairsPerUnit" type="number" class="input-yellow" value="750"></div>
        <div class="compact-row"><label>Utilities $/unit/yr</label><input id="utilPerUnit" type="number" class="input-yellow" value="600"></div>
        <div class="compact-row"><label>Turn/Leasing $/unit/yr</label><input id="turnPerUnit" type="number" class="input-yellow" value="200"></div>
        <div class="compact-row"><label>Asset Mgmt % of EGI</label><input id="assetPct" type="number" class="input-yellow" value="1"></div>
        <div class="compact-row"><label>Vacancy %</label><input id="vacancy" type="number" class="input-yellow" value="5"></div>
        <div class="compact-row"><label>Rent Growth %</label><input id="rentGrowth" type="number" class="input-yellow" value="5"></div>
        <div class="compact-row"><label>Expense Growth %</label><input id="expenseGrowth" type="number" class="input-yellow" value="3"></div>
      </div>
    </div>

    <!-- Right: Unit Mix + LTV/Other Income/Improvements -->
    <div class="panel">
      <h3 style="margin:0 0 6px">Unit Mix & Finance</h3>
      <div class="meta">In-place rent and Pro Forma rent retained. Monthly totals are calculated from Pro Forma rent.</div>

      <table class="units-table">
        <thead><tr><th>Unit Type</th><th>Count</th><th>Sq Ft</th><th>In-place Rent</th><th>Pro Forma Rent</th><th>Monthly Total</th></tr></thead>
        <tbody id="unitBody">
          <tr><td>Studio/Loft</td><td class="input"><input class="u-count input-yellow" type="number" value="8"></td><td class="input"><input class="u-sqft input-yellow" type="number" value="600"></td><td class="input"><input class="u-cur input-yellow" type="number" value="1026"></td><td class="input"><input class="u-pro input-yellow" type="number" value="1600"></td><td class="formula right" data-rowindex="0">0</td></tr>
          <tr><td>Studio</td><td class="input"><input class="u-count input-yellow" type="number" value="8"></td><td class="input"><input class="u-sqft input-yellow" type="number" value="650"></td><td class="input"><input class="u-cur input-yellow" type="number" value="2603"></td><td class="input"><input class="u-pro input-yellow" type="number" value="2800"></td><td class="formula right" data-rowindex="1">0</td></tr>
          <tr><td>1BR</td><td class="input"><input class="u-count input-yellow" type="number" value="12"></td><td class="input"><input class="u-sqft input-yellow" type="number" value="750"></td><td class="input"><input class="u-cur input-yellow" type="number" value="3601"></td><td class="input"><input class="u-pro input-yellow" type="number" value="3800"></td><td class="formula right" data-rowindex="2">0</td></tr>
          <tr><td>2BR</td><td class="input"><input class="u-count input-yellow" type="number" value="15"></td><td class="input"><input class="u-sqft input-yellow" type="number" value="900"></td><td class="input"><input class="u-cur input-yellow" type="number" value="4375"></td><td class="input"><input class="u-pro input-yellow" type="number" value="4600"></td><td class="formula right" data-rowindex="3">0</td></tr>
          <tr><td>3BR</td><td class="input"><input class="u-count input-yellow" type="number" value="7"></td><td class="input"><input class="u-sqft input-yellow" type="number" value="1200"></td><td class="input"><input class="u-cur input-yellow" type="number" value="5050"></td><td class="input"><input class="u-pro input-yellow" type="number" value="5300"></td><td class="formula right" data-rowindex="4">0</td></tr>
        </tbody>
        <tfoot>
          <tr><td><strong>TOTALS</strong></td><td id="unitTotal" class="formula">0</td><td id="sqftTotal" class="formula">0</td><td></td><td></td><td id="rentTotal" class="formula">0</td></tr>
        </tfoot>
      </table>

      <hr style="margin:8px 0">
      <div class="compact-row"><label>LTV %</label><input id="ltv" type="number" class="input-yellow" value="60"></div>
      <div class="compact-row"><label>Interest Rate %</label><input id="interestRate" type="number" class="input-yellow" value="5.5"></div>
      <div class="compact-row"><label>Other Income (monthly)</label><input id="otherIncome" type="number" class="input-yellow" value="10500"></div>
      <div class="compact-row"><label>Improvement %</label><input id="improvePct" type="number" class="input-yellow" value="75"></div>

    </div>

    <!-- Pro Forma (2-year projection) full width -->
    <div style="grid-column:1 / -1">
      <div class="panel">
        <h3 style="margin:0 0 6px">TAB 2 — PRO FORMA (2-Year)</h3>
        <div class="small meta">"Calculate In" will copy In-place rents into Pro Forma rents (if you choose) and populate Years 1–2.</div>

        <table class="pro" id="proTable">
          <thead>
            <tr><th>Line Item</th><th>Year 1</th><th>Year 2</th></tr>
          </thead>
          <tbody>
            <tr><th style="text-align:left">Gross Potential Rent</th><td class="formula" id="gpr1">0</td><td class="formula" id="gpr2">0</td></tr>
            <tr><th style="text-align:left">(+) Other Income</th><td class="formula" id="oi1">0</td><td class="formula" id="oi2">0</td></tr>
            <tr><th style="text-align:left">(-) Vacancy Loss</th><td class="formula" id="vac1">0</td><td class="formula" id="vac2">0</td></tr>
            <tr><th style="text-align:left">= Effective Gross Income</th><td class="formula" id="egi1">0</td><td class="formula" id="egi2">0</td></tr>
            <tr><th style="text-align:left">Total Expenses</th><td class="formula" id="totexp1">0</td><td class="formula" id="totexp2">0</td></tr>
            <tr><th style="text-align:left">= NOI</th><td class="formula" id="noi1">0</td><td class="formula" id="noi2">0</td></tr>
            <tr><th style="text-align:left">(-) Debt Service</th><td class="formula" id="debt1">0</td><td class="formula" id="debt2">0</td></tr>
            <tr><th style="text-align:left">= Cash Flow After Debt</th><td class="formula" id="cf1">0</td><td class="formula" id="cf2">0</td></tr>
          </tbody>
        </table>

        <div class="kpis" style="margin-top:10px">
          <div class="kpi"><h3>Purchase Price</h3><p id="k_purchase">—</p></div>
          <div class="kpi"><h3>Initial Equity</h3><p id="k_equity">—</p></div>
          <div class="kpi"><h3>Project IRR</h3><p id="k_irr">—</p></div>
          <div class="kpi"><h3>Equity Multiple</h3><p id="k_em">—</p></div>
          <div class="kpi"><h3>Avg Cash-on-Cash</h3><p id="k_coc">—</p></div>
        </div>

        <div class="media-grid">
          <div></div>
          <div class="video-drop" id="videoDrop"><div class="hint">DROP YOUTUBE VIDEO EMBED HERE</div></div>
          <div></div>
        </div>

      </div>
    </div>

    
  </div>

  <footer>
    <div><a href="https://www.coffeebarconnoisseur.com">coffeebarconnoisseur.com</a> · <a href="https://www.coffeebarroasters.com">coffeebarroasters.com</a> · <a href="https://www.dividond.com">dividond.com</a> · <a href="https://www.decodedmusic.com">decodedmusic.com</a></div>
    <div style="margin-top:6px"><a href="https://www.youtube.com/@designrenovate">YouTube — DesignRenovate</a></div>
  </footer>
</div>

<script>
// Helpers
function toNum(v){return typeof v==='number'?v: (v===''?0:parseFloat(String(v).replace(/[,\$]/g,''))||0)}
function fmt(n){ if(n===null||n===undefined) return '0'; return (Math.round(n)).toLocaleString(); }

// Update monthly totals (calculated from PRO FORMA rent)
function updateUnitTotals(){
  const rows = document.querySelectorAll('#unitBody tr');
  let unitTotal=0; let sqftTotal=0; let rentMonthlyTotal=0;
  rows.forEach((r,idx)=>{
    const count = toNum(r.querySelector('.u-count').value);
    const sqft = toNum(r.querySelector('.u-sqft').value);
    const pro = toNum(r.querySelector('.u-pro').value);
    const monthly = count * pro;
    r.querySelector('td.formula').textContent = fmt(monthly);
    unitTotal += count; sqftTotal += sqft*count; rentMonthlyTotal += monthly;
  });
  document.getElementById('unitTotal').textContent = unitTotal;
  document.getElementById('sqftTotal').textContent = fmt(sqftTotal);
  document.getElementById('rentTotal').textContent = fmt(rentMonthlyTotal);
  return {rentMonthlyTotal,unitTotal,sqftTotal};
}

// PMT and IRR
function pmty(rate, nper, pv){ if(rate<=0) return -(pv)/nper; const r = rate/12; return -(pv*r*Math.pow(1+r,nper))/(Math.pow(1+r,nper)-1); }
function irr(cashflows, guess=0.12){ let x0=guess; for(let i=0;i<200;i++){ let f=0, df=0; for(let t=0;t<cashflows.length;t++){ f += cashflows[t]/Math.pow(1+x0,t); df += -t*cashflows[t]/Math.pow(1+x0,t+1);} const x1 = x0 - f/df; if(!isFinite(x1)) break; if(Math.abs(x1-x0) < 1e-6) return x1; x0=x1;} return NaN; }

// Calculate In: copies In-place rents to Pro Forma rents if user chooses, then populates pro forma
function calculateIn(){
  // Option: copy in-place rents to pro-forma (we'll do it by default)
  document.querySelectorAll('#unitBody tr').forEach(r=>{
    const cur = r.querySelector('.u-cur').value;
    if(cur !== undefined && cur !== null && cur !== ''){
      r.querySelector('.u-pro').value = cur;
    }
  });
  // update totals and populate proforma
  recalc(true);
}

function recalc(isCalculateIn){
  // update unit totals from pro-forma rents
  const unitInfo = updateUnitTotals();
  const rentMonthlyTotal = unitInfo.rentMonthlyTotal;
  const purchase = toNum(document.getElementById('purchasePrice').value);
  const ltv = toNum(document.getElementById('ltv').value)/100;
  const loan = purchase * ltv;
  const interest = toNum(document.getElementById('interestRate').value)/100;
  const otherMonthly = toNum(document.getElementById('otherIncome').value);
  const vacancy = toNum(document.getElementById('vacancy').value)/100;
  const units = toNum(document.getElementById('totalUnits').value);
  const propTaxPct = toNum(document.getElementById('propTaxPct').value)/100;
  const insPerUnit = toNum(document.getElementById('insPerUnit').value);
  const mgmtPct = toNum(document.getElementById('mgmtPct').value)/100;
  const repairs = toNum(document.getElementById('repairsPerUnit').value);
  const util = toNum(document.getElementById('utilPerUnit').value);
  const assetPct = toNum(document.getElementById('assetPct').value)/100;
  const improvePct = toNum(document.getElementById('improvePct').value)/100;
  const rentGrowth = toNum(document.getElementById('rentGrowth').value)/100;
  const expenseGrowth = toNum(document.getElementById('expenseGrowth').value)/100;
  const amort = document.getElementById('amortYears')?toNum(document.getElementById('amortYears').value):30;

  // Year 1 and Year 2 calculations
  const years = 2; const gpr = [], oi = [], vac = [], egi = [], totExp = [], noi = [], debt = [], cf = [];
  for(let y=0;y<years;y++){
    const gf = Math.pow(1+rentGrowth,y);
    gpr[y] = rentMonthlyTotal * 12 * gf;
    oi[y] = otherMonthly * 12 * Math.pow(1+rentGrowth,y);
    vac[y] = - (gpr[y] + oi[y]) * vacancy;
    egi[y] = gpr[y] + oi[y] + vac[y];

    const propTax = purchase * propTaxPct * Math.pow(1+expenseGrowth,y);
    const insurance = insPerUnit * units * Math.pow(1+expenseGrowth,y);
    const mgmt = egi[y] * mgmtPct;
    const rep = repairs * units * Math.pow(1+expenseGrowth,y);
    const utilities = util * units * Math.pow(1+expenseGrowth,y);
    const asset = egi[y] * assetPct;
    totExp[y] = propTax + insurance + mgmt + rep + utilities + asset;
    noi[y] = egi[y] - totExp[y];

    if(amort===0) debt[y] = loan * interest; else debt[y] = - pmty(interest, amort*12, loan) * 12;
    cf[y] = noi[y] - debt[y];
  }

  // populate pro forma fields formatted with commas
  for(let y=1;y<=2;y++){
    document.getElementById('gpr'+y).textContent = fmt(gpr[y-1]);
    document.getElementById('oi'+y).textContent = fmt(oi[y-1]);
    document.getElementById('vac'+y).textContent = fmt(vac[y-1]);
    document.getElementById('egi'+y).textContent = fmt(egi[y-1]);
    document.getElementById('totexp'+y).textContent = fmt(totExp[y-1]);
    document.getElementById('noi'+y).textContent = fmt(noi[y-1]);
    document.getElementById('debt'+y).textContent = fmt(-Math.round(debt[y-1]||0));
    document.getElementById('cf'+y).textContent = fmt(cf[y-1]);
  }

  // KPIs
  document.getElementById('k_purchase').textContent = '$'+fmt(purchase);
  const initialEquity = purchase - loan; document.getElementById('k_equity').textContent = '$'+fmt(initialEquity);
  const capRate = 0.045; const noiYear2 = noi[1]||0; const noiYear3 = noiYear2 * 1.03; const exitPrice = noiYear3 / capRate; const sellingCosts = exitPrice * 0.02; const loanPayoff = loan; const netProceeds = exitPrice - sellingCosts - loanPayoff;
  const cashflows = [-initialEquity, Math.round(cf[0]||0), Math.round((cf[1]||0) + netProceeds)];
  const irrVal = irr(cashflows);
  const em = ((cf[0]||0) + (cf[1]||0) + netProceeds)/initialEquity;
  const avgCoc = (((cf[0]||0) + (cf[1]||0))/2) / initialEquity * 100;
  document.getElementById('k_irr').textContent = isNaN(irrVal)?'—':( (irrVal*100).toFixed(1) + '%' );
  document.getElementById('k_em').textContent = isFinite(em)?em.toFixed(2)+'x':'—';
  document.getElementById('k_coc').textContent = isFinite(avgCoc)?avgCoc.toFixed(1)+'%':'—';
}

// wire up events
function attachEvents(){
  document.getElementById('recalcBtn').addEventListener('click',()=>recalc(false));
  document.getElementById('calcInBtn').addEventListener('click',calculateIn);
  document.getElementById('exportBtn').addEventListener('click',exportCSV);
  document.getElementById('resetBtn').addEventListener('click',()=>location.reload());
  document.querySelectorAll('#unitBody input').forEach(i=>i.addEventListener('input',updateUnitTotals));
}

function exportCSV(){
  const rows = [];
  rows.push(['Line Item','Year1','Year2'].join(','));
  const tb = document.getElementById('proTable');
  for(let r=0;r<tb.tBodies[0].rows.length;r++){
    const row = tb.tBodies[0].rows[r]; const cols=[row.cells[0].textContent.trim().replace(/,/g,'')]; for(let c=1;c<row.cells.length;c++) cols.push(row.cells[c].textContent.trim().replace(/,/g,'')); rows.push(cols.join(',')); }
  const csv = rows.join('
'); const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='proforma_2yr.csv'; a.click(); URL.revokeObjectURL(url);
}

// init
attachEvents(); updateUnitTotals();
</script>
</body>
</html>
