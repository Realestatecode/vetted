<!doctype html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-P4TD9G7W5V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-P4TD9G7W5V');
</script>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>REAL ESTATE FINANCE MODEL</title>
<meta name="description" content="Multifamily | Apartment Real Estate Financial Model" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bank-blue: #0f1b2d;
    --bank-accent: #005eb8;
    --bg: #ffffff;
    --panel-bg: #ffffff;
    --border: #cbd5e1;
    --input-yellow: #fef9c3; /* Subtle yellow for inputs */
    --readonly: #f8fafc;
    --text-main: #0f172a;
    --text-muted: #64748b;
  }

  body { margin: 0; padding: 0; background: #f1f5f9; font-family: 'Inter', sans-serif; color: var(--text-main); -webkit-print-color-adjust: exact; }
  .wrap { max-width: 1000px; margin: 20px auto; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 30px; border-top: 6px solid var(--bank-blue); }

  /* --- TYPOGRAPHY & UTILS --- */
  h1, h2, h3, h4 { margin: 0; letter-spacing: -0.02em; }
  h3 { font-size: 14px; text-transform: uppercase; color: var(--text-muted); border-bottom: 2px solid var(--bank-blue); padding-bottom: 4px; margin-bottom: 12px; letter-spacing: 0.05em; font-weight: 700; }
  .logo-text { font-family: 'Times New Roman', serif; font-weight: bold; font-size: 24px; color: var(--bank-blue); }
  
  /* --- HEADER --- */
  header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; }
  .controls button { background: white; border: 1px solid var(--border); padding: 6px 12px; font-size: 12px; font-weight: 600; color: var(--text-main); cursor: pointer; border-radius: 2px; transition: all 0.2s; }
  .controls button:hover { background: #f1f5f9; border-color: var(--bank-accent); }
  .controls button.primary { background: var(--bank-blue); color: white; border-color: var(--bank-blue); }
  .controls button.primary:hover { background: #1e3a8a; }

  /* --- GRID LAYOUTS --- */
  .input-grid { display: grid; grid-template-columns: 320px 1fr; gap: 25px; margin-bottom: 30px; }
  .section-box { margin-bottom: 20px; }
  
  /* --- INPUT ROWS --- */
  .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; font-size: 12px; }
  .row label { color: var(--text-muted); font-weight: 500; }
  input { font-family: 'Roboto Mono', monospace; font-size: 12px; padding: 4px 6px; border: 1px solid var(--border); width: 100px; text-align: right; outline: none; border-radius: 0; }
  input:focus { border-color: var(--bank-accent); box-shadow: 0 0 0 1px var(--bank-accent); }
  input.yellow { background-color: var(--input-yellow); border-color: #e2e8f0; }
  input.readonly { background-color: var(--readonly); border: none; color: var(--text-main); font-weight: 600; }

  /* --- TABLES (Bank Style) --- */
  table { width: 100%; border-collapse: collapse; font-size: 11px; }
  th { text-align: left; font-weight: 600; color: var(--text-muted); border-bottom: 1px solid var(--text-muted); padding: 6px 4px; text-transform: uppercase; font-size: 10px; }
  td { padding: 6px 4px; border-bottom: 1px solid #f1f5f9; }
  td.num { text-align: right; font-family: 'Roboto Mono', monospace; }
  tr:last-child td { border-bottom: none; }
  tfoot td { border-top: 2px solid var(--text-muted); font-weight: 700; background: #f8fafc; }
  .highlight-row td { background-color: #f0f9ff; font-weight: 600; border-top: 1px solid #bae6fd; border-bottom: 1px solid #bae6fd; }

  /* --- UNIT INPUT TABLE --- */
  .unit-table input { width: 100%; box-sizing: border-box; border: none; background: transparent; text-align: center; }
  .unit-table input.yellow { background: var(--input-yellow); }
  .unit-table td { border: 1px solid #e2e8f0; padding: 0; }

  /* --- MIDDLE SECTION --- */
  .mid-section { display: grid; grid-template-columns: 1fr 200px 1fr; gap: 20px; align-items: center; margin: 30px 0; text-align: center; }
  
  /* CTA BOX */
  .cta-box { grid-column: 1 / -1; background: var(--bank-blue); color: white; padding: 10px; font-size: 13px; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 20px; border-radius: 2px; text-transform: uppercase; }
  .cta-box a { color: white; text-decoration: none; border-bottom: 1px dotted white; }

  /* VIDEO DROP */
  .video-drop { height: 150px; border: 2px dashed #94a3b8; background: #f8fafc; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #64748b; font-weight: 600; margin: 0 auto; width: 100%; max-width: 600px; grid-column: 1 / -1; }

  /* --- KPI CARDS --- */
  .kpi-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 15px; }
  .kpi { background: #f8fafc; border: 1px solid var(--border); padding: 10px; text-align: center; }
  .kpi span { display: block; font-size: 10px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 4px; }
  .kpi strong { font-size: 16px; color: var(--bank-blue); font-family: 'Roboto Mono', monospace; }

  /* --- FOOTER --- */
  footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center; font-size: 11px; color: var(--text-muted); line-height: 1.6; }
  footer a { color: var(--bank-accent); text-decoration: none; font-weight: 500; }
  footer a:hover { text-decoration: underline; }

  /* --- PRINT --- */
  @media print {
    body { background: white; }
    .wrap { box-shadow: none; margin: 0; padding: 0; border: none; width: 100%; max-width: 100%; }
    .controls, .cta-box { display: none; }
    .video-drop { border: 1px solid #ccc; height: 100px; }
    input { border: none; padding: 0; background: transparent !important; text-align: right; }
    .input-grid { gap: 20px; }
    h3 { font-size: 12px; border-bottom: 1px solid #000; color: #000; }
    table { font-size: 9px; }
    th { color: #000; border-color: #000; }
  }
</style>
</head>
<body>

<div class="wrap">
  
  <!-- LOGO ROW -->
  <header>
    <div class="logo-text">REALFIMO<span style="font-weight:400; font-size:16px; color:#64748b;">| Real Estate Finance Model Analytics</span></div>
    <div class="controls">
      <button id="btnReset">Reset</button>
      <button class="primary" id="btnCalcIn">Copy In-Place Rents</button>
      <button class="primary" id="btnExport">Export CSV</button>
    </div>
  </header>

  <!-- INPUTS GRID -->
  <div class="input-grid">
    
    <!-- LEFT: ASSUMPTIONS -->
    <div class="left-panel">
      <div class="section-box">
        <h3>1. Deal Assumptions (Inputs)</h3>
        <div class="row"><label>Project Name</label><input id="i_name" type="text" class="yellow" style="text-align:left; width:140px" value="Project xyz"></div>
        <div class="row"><label>Purchase Price</label><input id="i_price" type="text" class="yellow" value="20,000,000"></div>
        <div class="row"><label>Closing Costs %</label><input id="i_close" type="number" class="yellow" value="1.0"></div>
        <div class="row"><label>Reno Budget</label><input id="i_reno" type="text" class="yellow" value="500,000"></div>
        <div class="row"><label><strong>Total Basis</strong></label><input id="o_basis" class="readonly" readonly></div>
      </div>

      <div class="section-box">
        <h3>2. Financing</h3>
        <div class="row"><label>LTV %</label><input id="i_ltv" type="number" class="yellow" value="60.0"></div>
        <div class="row"><label>Interest Rate %</label><input id="i_rate" type="number" class="yellow" value="5.50"></div>
        <div class="row"><label>Amortization (Yrs)</label><input id="i_amort" type="number" class="yellow" value="30"></div>
        <div class="row"><label>Loan Amount</label><input id="o_loan" class="readonly" readonly></div>
        <div class="row"><label>Annual Debt Service</label><input id="o_debt" class="readonly" readonly></div>
      </div>

      <div class="section-box">
        <h3>3. OpEx & Growth (Year 1)</h3>
        <div class="row"><label>Prop Taxes (% Price)</label><input id="i_tax" type="number" class="yellow" value="1.25"></div>
        <div class="row"><label>Insurance ($/unit)</label><input id="i_ins" type="number" class="yellow" value="500"></div>
        <div class="row"><label>Mgmt Fee (% EGI)</label><input id="i_mgmt" type="number" class="yellow" value="4.0"></div>
        <div class="row"><label>R&M / Utilities ($/u)</label><input id="i_rm_util" type="number" class="yellow" value="1350"></div>
        <div class="row"><label>Other Income ($/mo)</label><input id="i_other" type="number" class="yellow" value="10500"></div>
        <div class="row"><label>Vacancy / Growth %</label><input id="i_vac_gro" type="number" class="yellow" value="5.0"></div>
      </div>
    </div>

    <!-- RIGHT: UNIT MIX -->
    <div class="right-panel">
      <h3>4. Unit Mix Analysis</h3>
      <table class="unit-table">
        <thead>
          <tr>
            <th style="width:30%">Type</th>
            <th style="width:12%">Cnt</th>
            <th style="width:12%">SqFt</th>
            <th style="width:18%">In-Place</th>
            <th style="width:18%; background:#fefce8; color:#b45309">Pro Forma</th>
            <th style="width:20%">Total/Mo</th>
          </tr>
        </thead>
        <tbody id="unitBody">
          <!-- Rows Generated by JS below, but hardcoded structure for stability -->
          <tr>
            <td><input type="text" value="Studio/Loft" readonly></td>
            <td><input class="yellow u-cnt" type="number" value="8"></td>
            <td><input class="yellow u-sq" type="number" value="600"></td>
            <td><input class="yellow u-cur" type="number" value="1026"></td>
            <td><input class="yellow u-pro" type="number" value="1600"></td>
            <td class="num u-tot" style="padding-right:6px; vertical-align:middle">0</td>
          </tr>
          <tr>
            <td><input type="text" value="Studio" readonly></td>
            <td><input class="yellow u-cnt" type="number" value="8"></td>
            <td><input class="yellow u-sq" type="number" value="650"></td>
            <td><input class="yellow u-cur" type="number" value="2603"></td>
            <td><input class="yellow u-pro" type="number" value="2800"></td>
            <td class="num u-tot" style="padding-right:6px; vertical-align:middle">0</td>
          </tr>
          <tr>
            <td><input type="text" value="1 Bedroom" readonly></td>
            <td><input class="yellow u-cnt" type="number" value="12"></td>
            <td><input class="yellow u-sq" type="number" value="750"></td>
            <td><input class="yellow u-cur" type="number" value="3601"></td>
            <td><input class="yellow u-pro" type="number" value="3800"></td>
            <td class="num u-tot" style="padding-right:6px; vertical-align:middle">0</td>
          </tr>
          <tr>
            <td><input type="text" value="2 Bedroom" readonly></td>
            <td><input class="yellow u-cnt" type="number" value="15"></td>
            <td><input class="yellow u-sq" type="number" value="900"></td>
            <td><input class="yellow u-cur" type="number" value="4375"></td>
            <td><input class="yellow u-pro" type="number" value="4600"></td>
            <td class="num u-tot" style="padding-right:6px; vertical-align:middle">0</td>
          </tr>
          <tr>
            <td><input type="text" value="3 Bedroom" readonly></td>
            <td><input class="yellow u-cnt" type="number" value="7"></td>
            <td><input class="yellow u-sq" type="number" value="1200"></td>
            <td><input class="yellow u-cur" type="number" value="5050"></td>
            <td><input class="yellow u-pro" type="number" value="5300"></td>
            <td class="num u-tot" style="padding-right:6px; vertical-align:middle">0</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" style="text-align:right; padding-right:10px;">TOTALS:</td>
            <td class="num" id="t_cur">0</td>
            <td class="num" id="t_pro">0</td>
            <td class="num" id="t_tot" style="background:#f0fdf4; color:#166534">0</td>
          </tr>
        </tfoot>
      </table>
      
      <div style="margin-top:15px; font-size:11px; color:#64748b; line-height:1.4">
        * <strong>Total/Mo Formula:</strong> Pro Forma Rent × Unit Count.<br>
        * Pro Forma model below annualizes this figure (×12).
      </div>
    </div>
  </div>

  <!-- CTA BAR -->
  <div class="cta-box">
    Contact 310.728.7974 for Real Estate Underwriting - Multifamily | Office | Retail | Net Lease | Hotel | Follow us on <a href="https://realestatecode.github.io/vetted" target="_blank">realestatecode.github.io/vetted</a>
  </div>

  <!-- MIDDLE LOGO & VIDEO -->
  <div class="mid-section">
    <div style="border-bottom: 1px solid #e2e8f0; height:1px"></div>
    <div class="logo-text" style="font-size:20px">REAL ESTATE EDGE</div>
    <div style="border-bottom: 1px solid #e2e8f0; height:1px"></div>
  </div>
  
  <div class="video-drop">
    [ DROP YOUTUBE VIDEO EMBED HERE ]
  </div>

  <br>

  <!-- PRO FORMA ENGINE -->
  <div class="section-box">
    <h3>5. 10-Year Pro Forma Projection (for illustration only - for complex projects - investors are expected to perform their own due diligience as interest rate, occupancy and market conditions can change and will impact financial outlook.</h3>
    
    <div class="kpi-row">
      <div class="kpi"><span>Initial Equity</span><strong id="k_eq">-</strong></div>
      <div class="kpi"><span>IRR (Levered)</span><strong id="k_irr">-</strong></div>
      <div class="kpi"><span>Equity Multiple</span><strong id="k_em">-</strong></div>
      <div class="kpi"><span>Avg Cash/Cash</span><strong id="k_coc">-</strong></div>
      <div class="kpi"><span>Exit Price (Yr10)</span><strong id="k_exit">-</strong></div>
    </div>

    <div style="overflow-x:auto">
      <table id="proTable">
        <thead>
          <!-- JS Populated -->
        </thead>
        <tbody>
          <!-- JS Populated -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div><a href="https://www.coffeebarconnoisseur.com">coffeebarconnoisseur.com</a> · <a href="https://www.coffeebarroasters.com">coffeebarroasters.com</a> · <a href="https://www.dividond.com">dividond.com</a> · <a href="https://www.decodedmusic.com">decodedmusic.com</a></div>
    <div style="margin-top:6px"><a href="https://www.youtube.com/@designrenovate">YouTube — DesignRenovate</a></div>
  </footer>

</div>

<script>
/* --- HELPERS --- */
const $ = id => document.getElementById(id);
const toNum = val => parseFloat(String(val).replace(/[,\$]/g,'')) || 0;
const fmt = (n, d=0) => n.toLocaleString('en-US', {minimumFractionDigits:d, maximumFractionDigits:d});

/* --- FINANCIAL MATH --- */
function PMT(rate, nper, pv) {
  if(!rate) return -(pv/nper);
  const r = rate/12; 
  const n = nper*12;
  return - (pv * r * Math.pow(1+r, n)) / (Math.pow(1+r, n) - 1);
}

function IRR(values, guess=0.1) {
  const maxIter = 1000; const tol = 1e-6;
  let x0 = guess;
  for(let i=0; i<maxIter; i++){
    let f=0, df=0;
    for(let j=0; j<values.length; j++){
      f += values[j]/Math.pow(1+x0, j);
      df += -j*values[j]/Math.pow(1+x0, j+1);
    }
    let x1 = x0 - f/df;
    if(Math.abs(x1-x0) < tol) return x1;
    x0 = x1;
  }
  return 0;
}

/* --- MAIN CALCULATION --- */
function calculate() {
  // 1. Unit Mix Logic
  let totalMonthly = 0;
  let totalCur = 0, totalPro = 0;
  document.querySelectorAll('#unitBody tr').forEach(row => {
    const cnt = toNum(row.querySelector('.u-cnt').value);
    const cur = toNum(row.querySelector('.u-cur').value);
    const pro = toNum(row.querySelector('.u-pro').value);
    
    // Formula: Pro Rent * Count
    const lineTotal = pro * cnt;
    row.querySelector('.u-tot').textContent = fmt(lineTotal);
    
    totalMonthly += lineTotal;
    totalCur += cur * cnt;
    totalPro += pro * cnt;
  });
  
  $('t_cur').textContent = fmt(totalCur);
  $('t_pro').textContent = fmt(totalPro);
  $('t_tot').textContent = fmt(totalMonthly);

  // 2. Acquisition & Debt
  const price = toNum($('i_price').value);
  const close = price * (toNum($('i_close').value)/100);
  const reno = toNum($('i_reno').value);
  const basis = price + close + reno;
  $('o_basis').value = fmt(basis);

  const loan = price * (toNum($('i_ltv').value)/100);
  $('o_loan').value = fmt(loan);
  
  const rate = toNum($('i_rate').value)/100;
  const amort = toNum($('i_amort').value);
  // Calculate annual debt service
  let annualDebt = 0;
  if(amort > 0) {
    annualDebt = Math.abs(PMT(rate, amort, loan)) * 12;
  } else {
    annualDebt = loan * rate; // Interest Only
  }
  $('o_debt').value = fmt(annualDebt);

  // 3. 10-Year Pro Forma
  const years = 10;
  const growth = toNum($('i_vac_gro').value)/100; // Use same % for vacancy and growth for simplicity
  const vacancyRate = toNum($('i_vac_gro').value)/100;
  const otherIncMo = toNum($('i_other').value);
  const taxStart = price * (toNum($('i_tax').value)/100);
  
  // Expense inputs (Sum of unit based expenses)
  // Hardcoding unit count to 50 based on prompt inputs if dynamic count isn't needed globally, 
  // but better to sum the 'cnt' from table.
  let unitCount = 0;
  document.querySelectorAll('.u-cnt').forEach(i => unitCount += toNum(i.value));
  
  const insStart = toNum($('i_ins').value) * unitCount;
  const rmStart = toNum($('i_rm_util').value) * unitCount;
  const mgmtPct = toNum($('i_mgmt').value)/100;

  let d_gpr=[], d_egi=[], d_exp=[], d_noi=[], d_cf=[];

  for(let y=1; y<=years; y++) {
    // Revenue
    // Year 1 = Base, Year 2+ = Growth
    const gf = Math.pow(1.03, y-1); // 3% Expense growth standard
    const rg = Math.pow(1+growth, y-1); // Revenue growth

    const gpr = (totalMonthly * 12) * rg;
    const other = (otherIncMo * 12) * rg;
    const vac = -(gpr + other) * vacancyRate;
    const egi = gpr + other + vac;

    // Expenses
    const tax = taxStart * gf; // Prop 13 style or standard 2-3%
    const ins = insStart * gf;
    const rm = rmStart * gf;
    const mgmt = egi * mgmtPct;
    const totalExp = tax + ins + rm + mgmt;

    const noi = egi - totalExp;
    const cf = noi - annualDebt; // Pre-tax cash flow

    d_gpr.push(gpr); d_egi.push(egi); d_exp.push(totalExp); d_noi.push(noi); d_cf.push(cf);
  }

  renderTable(d_gpr, d_egi, d_exp, d_noi, annualDebt, d_cf);
  updateKPIs(basis, loan, d_cf, d_noi[9]);
}

function renderTable(gpr, egi, exp, noi, debt, cf) {
  const thead = $('proTable').querySelector('thead');
  const tbody = $('proTable').querySelector('tbody');
  
  let h = `<tr><th style="min-width:120px">Item</th>`;
  for(let i=1; i<=10; i++) h += `<th>Year ${i}</th>`;
  h += `</tr>`;
  thead.innerHTML = h;

  const mkRow = (lbl, data, cls='') => {
    let r = `<tr class="${cls}"><td>${lbl}</td>`;
    data.forEach(v => r += `<td class="num">${fmt(v)}</td>`);
    return r + `</tr>`;
  };

  let b = '';
  b += mkRow('Gross Potential Rent', gpr);
  b += mkRow('Effective Gross Inc', egi, 'highlight-row');
  b += mkRow('Total Expenses', exp.map(x=>-x)); // Show as negative for visual? Or positive in calc? Usually expense is positive number subtracted. Let's show standard accounting (positive number implied deduction).
  b += mkRow('Net Operating Income', noi, 'highlight-row');
  b += mkRow('Debt Service', Array(10).fill(-debt));
  b += mkRow('CASH FLOW', cf, 'highlight-row');
  
  tbody.innerHTML = b;
}

function updateKPIs(basis, loan, cfs, noi10) {
  const equity = basis - loan;
  $('k_eq').textContent = '$' + fmt(equity);

  // Exit
  const cap = 0.05; // 5% exit cap assumption
  const exitPrice = noi10 / cap;
  const netSale = exitPrice * 0.98 - loan; // 2% cost of sale
  
  // IRR Stream
  let stream = [-equity, ...cfs];
  stream[10] += netSale;
  
  const irr = IRR(stream);
  const mult = (cfs.reduce((a,b)=>a+b,0) + netSale) / equity;
  const avgCoc = (cfs.reduce((a,b)=>a+b,0)/10) / equity;

  $('k_irr').textContent = (irr*100).toFixed(2) + '%';
  $('k_em').textContent = mult.toFixed(2) + 'x';
  $('k_coc').textContent = (avgCoc*100).toFixed(2) + '%';
  $('k_exit').textContent = '$' + fmt(exitPrice);
}

/* --- EVENTS --- */
document.addEventListener('DOMContentLoaded', () => {
  const inputs = document.querySelectorAll('input');
  inputs.forEach(i => i.addEventListener('input', calculate));

  $('btnCalcIn').addEventListener('click', () => {
    document.querySelectorAll('#unitBody tr').forEach(r => {
      const cur = r.querySelector('.u-cur').value;
      if(cur) r.querySelector('.u-pro').value = cur;
    });
    calculate();
  });
  
  $('btnReset').addEventListener('click', () => location.reload());

  $('btnExport').addEventListener('click', () => {
    let csv = [];
    document.querySelectorAll('#proTable tr').forEach(tr => {
      let cols = Array.from(tr.querySelectorAll('td,th')).map(td => '"'+td.innerText.replace(/,/g,'')+'"');
      csv.push(cols.join(','));
    });
    const blob = new Blob([csv.join('\n')], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href=url; a.download='jpm_model_export.csv'; a.click();
  });

  calculate(); // Init
});
</script>
</body>
</html>
